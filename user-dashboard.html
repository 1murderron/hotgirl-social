<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - hotgirl.social</title>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <h2>hotgirl.social</h2>
            </div>
            <div class="header-actions">
                <a href="#" id="view-profile" class="btn btn-outline" target="_blank">View My Profile</a>
                <button onclick="logout()" class="btn btn-secondary">Logout</button>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="nav-item active" onclick="showSection('profile')">
                <span class="nav-icon">üë§</span>
                <span class="nav-text">Profile</span>
            </div>
            <div class="nav-item" onclick="showSection('links')">
                <span class="nav-icon">üîó</span>
                <span class="nav-text">My Links</span>
            </div>
            <div class="nav-item" onclick="showSection('appearance')">
                <span class="nav-icon">üé®</span>
                <span class="nav-text">Appearance</span>
            </div>
            <div class="nav-item" onclick="showSection('analytics')">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Analytics</span>
            </div>
            <div class="nav-item" onclick="showSection('settings')">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Settings</span>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Profile Section -->
            <section id="profile" class="content-section active">
                <div class="section-header">
                    <h1>Profile Information</h1>
                    <p>Customize how your profile appears to visitors</p>
                </div>

                <div class="content-grid">
                    <!-- Profile Photo -->
                    <div class="card">
                        <h3>Profile Photo</h3>
                        <div class="photo-upload">
                            <div class="photo-preview" id="photo-preview">
                                <div class="photo-placeholder">
                                    <span>üì∑</span>
                                    <p>Click to upload photo</p>
                                </div>
                            </div>
                            <input type="file" id="photo-input" accept="image/*" style="display: none;">
                            <button onclick="document.getElementById('photo-input').click()" class="btn btn-primary">
                                Upload Photo
                            </button>
                        </div>
                    </div>

                    <!-- Basic Info -->
                    <div class="card">
                        <h3>Basic Information</h3>
                        <form id="profile-form">
                            <div class="form-group">
                                <label for="display-name">Display Name</label>
                                <input type="text" id="display-name" placeholder="Your display name">
                            </div>
                            <div class="form-group">
                                <label for="bio">Bio</label>
                                <textarea id="bio" placeholder="Tell visitors about yourself..." rows="4"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </form>
                    </div>
                </div>

                <!-- Profile Preview -->
                <div class="card">
                    <h3>Profile Preview</h3>
                    <div class="profile-preview">
                        <div class="preview-header">
                            <div class="preview-photo" id="preview-photo">
                                <span>üë§</span>
                            </div>
                            <div class="preview-info">
                                <h4 id="preview-name">Your Display Name</h4>
                                <p id="preview-bio">Your bio will appear here...</p>
                            </div>
                        </div>
                        <div class="preview-links" id="preview-links">
                            <div class="preview-link">
                                <span>üîó</span>
                                <span>Your links will appear here</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Links Section -->
            <section id="links" class="content-section">
                <div class="section-header">
                    <h1>My Links</h1>
                    <p>Add and organize your social media and website links</p>
                </div>

                <!-- Add New Link -->
                <div class="card">
                    <h3>Add New Link</h3>
                    <form id="add-link-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="link-title">Link Title</label>
                                <input type="text" id="link-title" placeholder="e.g., Instagram, OnlyFans, Website">
                            </div>
                            <div class="form-group">
                                <label for="link-url">URL</label>
                                <input type="url" id="link-url" placeholder="https://...">
                            </div>
                            <div class="form-group">
                                <label for="link-icon">Icon</label>
                                <select id="link-icon">
                                    <option value="üîó">üîó Link</option>
                                    <option value="üì∑">üì∑ Instagram</option>
                                    <option value="üê¶">üê¶ Twitter</option>
                                    <option value="üíã">üíã OnlyFans</option>
                                    <option value="üåê">üåê Website</option>
                                    <option value="üì±">üì± TikTok</option>
                                    <option value="üí¨">üí¨ Snapchat</option>
                                    <option value="üíé">üíé Premium</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Link</button>
                    </form>
                </div>

                <!-- Existing Links -->
                <div class="card">
                    <h3>Your Links</h3>
                    <div id="links-list" class="links-list">
                        <div class="loading">Loading your links...</div>
                    </div>
                </div>
            </section>

            <!-- Appearance Section -->
            <section id="appearance" class="content-section">
                <div class="section-header">
                    <h1>Appearance</h1>
                    <p>Customize colors and themes for your profile</p>
                </div>

                <div class="content-grid">
                    <!-- Theme Selection -->
                    <div class="card">
                        <h3>Theme</h3>
                        <div class="theme-grid">
                            <div class="theme-option active" data-theme="default">
                                <div class="theme-preview gradient-default"></div>
                                <span>Default</span>
                            </div>
                            <div class="theme-option" data-theme="dark">
                                <div class="theme-preview gradient-dark"></div>
                                <span>Dark</span>
                            </div>
                            <div class="theme-option" data-theme="pink">
                                <div class="theme-preview gradient-pink"></div>
                                <span>Pink</span>
                            </div>
                            <div class="theme-option" data-theme="purple">
                                <div class="theme-preview gradient-purple"></div>
                                <span>Purple</span>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Colors -->
                    <div class="card">
                        <h3>Custom Colors</h3>
                        <div class="form-group">
                            <label for="bg-color">Background Color</label>
                            <div class="color-input">
                                <input type="color" id="bg-color" value="#667eea">
                                <input type="text" id="bg-color-text" value="#667eea">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="text-color">Text Color</label>
                            <div class="color-input">
                                <input type="color" id="text-color" value="#ffffff">
                                <input type="text" id="text-color-text" value="#ffffff">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveAppearance()">Save Colors</button>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="content-section">
                <div class="section-header">
                    <h1>Analytics</h1>
                    <p>See how your profile is performing</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-views">0</div>
                        <div class="stat-label">Total Views</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-clicks">0</div>
                        <div class="stat-label">Link Clicks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="link-count">0</div>
                        <div class="stat-label">Active Links</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="conversion-rate">0%</div>
                        <div class="stat-label">Click Rate</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Link Performance</h3>
                    <div id="link-stats" class="link-stats">
                        <div class="loading">Loading analytics...</div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="content-section">
                <div class="section-header">
                    <h1>Account Settings</h1>
                    <p>Manage your account preferences</p>
                </div>

                <div class="content-grid">
                    <!-- Account Info -->
                    <div class="card">
                        <h3>Account Information</h3>
                        <div class="account-info">
                            <div class="info-row">
                                <label>Username:</label>
                                <span id="account-username">Loading...</span>
                            </div>
                            <div class="info-row">
                                <label>Email:</label>
                                <span id="account-email">Loading...</span>
                            </div>
                            <div class="info-row">
                                <label>Member Since:</label>
                                <span id="account-joined">Loading...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Change Password -->
                    <div class="card">
                        <h3>Change Password</h3>
                        <form id="password-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" required>
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" required>
                            </div>
                            <div class="form-group">
                                <label for="confirm-password">Confirm New Password</label>
                                <input type="password" id="confirm-password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Success/Error Messages -->
    <div id="message-container"></div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://hotgirl-social-production.up.railway.app';
        let userToken = localStorage.getItem('userToken');
        let currentUser = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAuthStatus()) {
                loadUserData();
            }
        });

        // Authentication check
        function checkAuthStatus() {
            if (!userToken) {
                window.location.href = '/login.html';
                return false;
            }
            return true;
        }

        // API Helper Function
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(userToken && { 'Authorization': `Bearer ${userToken}` })
                },
                ...options
            };

            try {
                const response = await fetch(url, config);
                
                if (!response.ok) {
                    if (response.status === 401) {
                        localStorage.removeItem('userToken');
                        window.location.href = '/login.html';
                        throw new Error('Authentication required');
                    }
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }

        // Load user profile data
        async function loadUserData() {
            try {
                const profile = await apiCall('/profile');
                currentUser = profile;
                
                // Update profile form
                document.getElementById('display-name').value = profile.display_name || '';
                document.getElementById('bio').value = profile.bio || '';
                
                // Update preview
                updatePreview();
                
                // Update account info
                document.getElementById('account-username').textContent = profile.username;
                document.getElementById('account-email').textContent = profile.email || 'N/A';
                document.getElementById('account-joined').textContent = new Date(profile.created_at).toLocaleDateString();
                
                // Set profile link
                document.getElementById('view-profile').href = `/u/${profile.username}`;
                
                // Load links
                loadLinks();
                
                // Load analytics
                loadAnalytics();
                
            } catch (error) {
                showMessage('Failed to load profile data', 'error');
            }
        }

        // Update profile preview
        function updatePreview() {
            const displayName = document.getElementById('display-name').value || 'Your Display Name';
            const bio = document.getElementById('bio').value || 'Your bio will appear here...';
            
            document.getElementById('preview-name').textContent = displayName;
            document.getElementById('preview-bio').textContent = bio;
        }

        // Navigation
        function showSection(sectionId) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Update content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Profile form submission
        document.getElementById('profile-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const displayName = document.getElementById('display-name').value;
            const bio = document.getElementById('bio').value;
            
            try {
                await apiCall('/profile', {
                    method: 'PUT',
                    body: JSON.stringify({
                        display_name: displayName,
                        bio: bio
                    })
                });
                
                showMessage('Profile updated successfully!', 'success');
                updatePreview();
            } catch (error) {
                showMessage('Failed to update profile', 'error');
            }
        });

        // Photo upload
        document.getElementById('photo-input').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('profileImage', file);
            
            try {
                const response = await fetch(`${API_BASE_URL}/profile/upload-image`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showMessage('Photo uploaded successfully!', 'success');
                    loadUserData(); 
                    
                    // Reload to show new photo
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                showMessage('Failed to upload photo', 'error');
            }
        });

        // Load links
        async function loadLinks() {
            try {
                const profile = await apiCall('/profile');
                const linksList = document.getElementById('links-list');
                
                if (profile.links && profile.links.length > 0) {
                    linksList.innerHTML = profile.links.map(link => `
                        <div class="link-item" data-id="${link.id}">
                            <div class="link-info">
                                <span class="link-icon">${link.icon || 'üîó'}</span>
                                <div class="link-details">
                                    <div class="link-title">${link.title}</div>
                                    <div class="link-url">${link.url}</div>
                                </div>
                                <div class="link-stats">
                                    <span class="click-count">${link.clicks || 0} clicks</span>
                                </div>
                            </div>
                            <div class="link-actions">
                                <button onclick="editLink(${link.id})" class="btn btn-small">Edit</button>
                                <button onclick="deleteLink(${link.id})" class="btn btn-small btn-danger">Delete</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    linksList.innerHTML = '<div class="empty-state">No links added yet. Add your first link above!</div>';
                }
                
                // Update preview
                updateLinksPreview(profile.links || []);
            } catch (error) {
                document.getElementById('links-list').innerHTML = '<div class="error">Failed to load links</div>';
            }
        }

        // Add new link
        document.getElementById('add-link-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('link-title').value;
            const url = document.getElementById('link-url').value;
            const icon = document.getElementById('link-icon').value;
            
            try {
                await apiCall('/links', {
                    method: 'POST',
                    body: JSON.stringify({ title, url, icon })
                });
                
                showMessage('Link added successfully!', 'success');
                this.reset();
                loadLinks();
            } catch (error) {
                showMessage('Failed to add link', 'error');
            }
        });

        // Delete link
        async function deleteLink(linkId) {
            if (!confirm('Are you sure you want to delete this link?')) return;
            
            try {
                await apiCall(`/links/${linkId}`, { method: 'DELETE' });
                showMessage('Link deleted successfully!', 'success');
                loadLinks();
            } catch (error) {
                showMessage('Failed to delete link', 'error');
            }
        }

        // Load analytics
        async function loadAnalytics() {
            try {
                const analytics = await apiCall('/analytics');
                
                document.getElementById('total-views').textContent = analytics.total_views || 0;
                
                const totalClicks = analytics.link_stats?.reduce((sum, link) => sum + (link.clicks || 0), 0) || 0;
                document.getElementById('total-clicks').textContent = totalClicks;
                document.getElementById('link-count').textContent = analytics.link_stats?.length || 0;
                
                const clickRate = analytics.total_views > 0 ? ((totalClicks / analytics.total_views) * 100).toFixed(1) : 0;
                document.getElementById('conversion-rate').textContent = clickRate + '%';
                
                // Load link stats
                const linkStats = document.getElementById('link-stats');
                if (analytics.link_stats && analytics.link_stats.length > 0) {
                    linkStats.innerHTML = analytics.link_stats.map(link => `
                        <div class="link-stat-item">
                            <div class="link-stat-name">${link.title}</div>
                            <div class="link-stat-clicks">${link.clicks || 0} clicks</div>
                        </div>
                    `).join('');
                } else {
                    linkStats.innerHTML = '<div class="empty-state">No link data available yet</div>';
                }
            } catch (error) {
                showMessage('Failed to load analytics', 'error');
            }
        }

        // Update links preview
        function updateLinksPreview(links) {
            const previewLinks = document.getElementById('preview-links');
            if (links && links.length > 0) {
                previewLinks.innerHTML = links.map(link => `
                    <div class="preview-link">
                        <span>${link.icon || 'üîó'}</span>
                        <span>${link.title}</span>
                    </div>
                `).join('');
            } else {
                previewLinks.innerHTML = '<div class="preview-link"><span>üîó</span><span>Your links will appear here</span></div>';
            }
        }

        // Show success/error messages
        function showMessage(message, type) {
            const container = document.getElementById('message-container');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = message;
            
            container.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 5000);
        }

        // Logout
        function logout() {
            localStorage.removeItem('userToken');
            window.location.href = '/';
        }

        // Real-time preview updates
        document.getElementById('display-name').addEventListener('input', updatePreview);
        document.getElementById('bio').addEventListener('input', updatePreview);
    </script>
</body>
</html>
