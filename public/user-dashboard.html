<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HotGirl.social - User Dashboard</title>
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="stylesheet" href="assets/qr-code.css">
    <style>

        .logo {
            max-width: 140px;
            margin: 0 auto 0 0;
            display: block;
        }

        .color-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .color-controls label {
            /* Text stays on the left automatically */
        }

        .color-controls input[type="color"] {
            /* Color picker stays on the right automatically */
        }

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    
</head>
<body class="dashboard">

    <!-- Navigation Header -->
    <header class="header">
        
        <div class="header-container">
            <div class="logo">
                <!-- <h2>hotgirl.social</h2> -->
                <a href="/">
                    <img src="/uploads/logo10.png" alt="HotGirl.social Logo" class="logo" />
                </a>
            </div>


            <div class="header-actions">
                <a href="#" id="view-profile" class="btn btn-outline" target="_blank">View My Profile</a>
                <button onclick="logout()" class="btn btn-secondary">Logout</button>
            </div>
        </div>
    </header>



    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="nav-item active" onclick="showSection('profile')">
                <span class="nav-icon">üë§</span>
            </br>
                <span class="nav-text">My Info</span>
            </div>
            <div class="nav-item" onclick="showSection('links')">
                <span class="nav-icon">üîó</span>
            </br>
                <span class="nav-text">My Links</span>
            </div>
            <div class="nav-item" onclick="showSection('appearance')">
                <span class="nav-icon">üé®</span>
            </br>
                <span class="nav-text">My Colors</span>
            </div>
            <div class="nav-item" onclick="showSection('analytics')">
                <span class="nav-icon">üìä</span>
            </br>
                <span class="nav-text">My Statistics</span>
            </div>

            <!-- <div class="nav-item" onclick="showSection('settings')">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Settings</span>
            </div>
            -->

        </nav>


        <!-- Main Content -->
        <main class="main-content">



            <!-- Profile Preview -->
                <div class="card">
                    <h3>Profile Preview</h3>
                    <div class="profile-preview">
                        <div class="preview-header">
                            <div class="preview-photo" id="preview-photo">
                                <span>üë§</span>
                            </div>
                            <div class="preview-info">
                                <h4 id="preview-name">Your Display Name</h4>
                                <p id="preview-bio">Your bio will appear here...</p>
                            </div>
                        </div>
                        <div class="preview-links" id="preview-links">
                            <div class="preview-link">
                                <span>üîó</span>
                                <span>Your links will appear here</span>
                            </div>
                        </div>
                    </div>
                </div>
            <!-- END Profile Preview -->


<!-- My HotGirl Button Link Section -->
 <div class="card">
    <div class="hotgirl-link-section" style="background: white; margin: 0;">
        <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: #1e293b;">Click to copy your HotGirl.social link.</h3>
        <div style="/* display: flex; */align-items: center; gap: 1rem; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; margin-bottom: 1rem;">
            
            <input type="text" id="profile-url" readonly 
                style="flex: 1; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; background: white; font-family: monospace; font-size: 0.9rem;"
                value="Loading...">
            
                <button id="copy-link-btn" onclick="copyProfileLink()" 
                    style="width: 100%; background: #f43f5e; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 500; cursor: pointer; white-space: nowrap; transition: transform 0.2s; margin: 10px 0;">
                Copy My HotGirl Link
            </button>
        </div>
        <div id="copy-success" style="color: #059669; font-weight: 500; text-align: center; opacity: 0; transition: opacity 0.3s;">
            ‚úì Link copied to clipboard!
        </div>
    </div>
    </div>
    <!-- END of My HotGirl Link Section -->


    <!-- ============== HotGirl QR Code Section ============================================== -->
        <div class="card">        
            <div class="qr-section">
                <h3>üîç QR Code for Your Profile</h3>
                <p>Generate a QR code that links directly to your profile page. Perfect for business cards, flyers, or social media!</p>
                
                <div class="qr-container">
                    <div class="qr-preview">
                        <div id="qrDisplay"></div>
                        <p class="profile-url">Profile URL: <span id="profileURL"></span></p>
                    </div>
                    
                    <div class="qr-controls">
                        <div class="color-controls">
                            <label for="qrForeground">QR Code Color:</label>
                            <input class="color-box" type="color" id="qrForeground" value="#F43F5E">
                        </br>
                            <label for="qrBackground">Background Color:</label>
                            <input class="color-box" type="color" id="qrBackground" value="#FEF2F2">
                        </div>
                        
                        <div class="qr-actions">
                            <button onclick="downloadQR()" id="downloadQRBtn" class="btn-download" style="display: none;">Download QR Code</button>
                        </div>
                    </div>
                </div>
                
                <div id="qrStatus" class="status-message"></div>
            </div>
        </div>    
    <!-- =================== END HotGirl QR Code Section ============================================== -->







        <!-- Profile Section -->
            <section id="profile" class="content-section active">
                <div class="section-header">
                   <!-- <h1>Profile Information</h1>
                    <p>Customize how your profile appears to visitors</p> -->
                </div>

                <div class="content-grid">
                    <!-- Profile Photo -->
                    <div class="card">
                        <h3>Add / Change Photo</h3>
                        <div class="photo-upload">
                            <div class="photo-preview" id="photo-preview">
                                <div class="photo-placeholder">
                                    <span>üì∑</span>
                                    <p onclick="document.getElementById('photo-input').click()">Click to upload photo</p>
                                </div>
                            </div>
                            <input type="file" id="photo-input" accept="image/*" style="display: none;">
                            <button onclick="document.getElementById('photo-input').click()" class="btn btn-primary">
                                Upload Photo
                            </button>
                        </div>
                    </div>

                    <!-- Basic Info -->
                    <div class="card">
                        <h3>Basic Info</h3>
                        <form id="profile-form">
                            <div class="form-group">
                                <label for="display-name">Display Name</label>
                                <input type="text" id="display-name" placeholder="Your display name">
                            </div>
                            <div class="form-group">
                                <label for="bio">Bio</label>
                                <textarea id="bio" placeholder="Tell visitors about yourself..." rows="4"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </form>


            </div>
                </div>

                <!-- Account Settings (moved from Settings section) -->
                <div class="content-grid">
                    <!-- Account Info -->
                    <div class="card">
                        <h3>Account Info</h3>
                        <div class="account-info">
                            <div class="info-row">
                                <label>Username:</label>
                                <span id="account-username">Loading...</span>
                            </div>
                            <div class="info-row">
                                <label>Email:</label>
                                <span id="account-email">Loading...</span>
                            </div>
                            <div class="info-row">
                                <label>Member Since:</label>
                                <span id="account-joined">Loading...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Change Password -->
                    <div class="card">
                        <h3>Change Password</h3>
                        <form id="password-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" required>
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" required>
                            </div>
                            <div class="form-group">
                                <label for="confirm-password">Confirm New Password</label>
                                <input type="password" id="confirm-password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </form>
                    </div>
                </div>

            </section>             




            <!-- Links Section -->
            <section id="links" class="content-section">
                <div class="section-header">
                <!-- <h1>Your Links</h1> -->
                </div>

                <!-- Add New Link -->
                <div class="card">
                    <h3 id="link-form-title">Add New Link</h3>
                    <p>Add and organize your social media and website links. Link to anything you want (as long as it's legal).</p>
                    <form id="add-link-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="link-title">Link Title</label>
                                <input type="text" id="link-title" placeholder="e.g., Instagram, OnlyFans, Website">
                            </div>
                            <div class="form-group">
                                <label for="link-url">URL</label>
                                <input type="url" id="link-url" placeholder="https://...">
                            </div>
                            <div class="form-group">
                                <label for="link-icon">Icon</label>
                                <select id="link-icon">
                                    <option value="üîó">üîó Link</option>
                                    <option value="üì∑">üì∑ Instagram</option>
                                    <option value="üê¶">üê¶ Twitter</option>
                                    <option value="üíã">üíã OnlyFans</option>
                                    <option value="üåê">üåê Website</option>
                                    <option value="üì±">üì± TikTok</option>
                                    <option value="üí¨">üí¨ Snapchat</option>
                                    <option value="üíé">üíé Premium</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-primary" id="link-submit-btn">Add Link</button>
                            <button type="button" class="btn btn-secondary" id="cancel-edit-btn" style="display: none;" onclick="cancelEdit()">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Existing Links -->
                <div class="card">
                    <h3>Your Links</h3>
                    <div id="links-list" class="links-list">
                        <div class="loading">Loading your links...</div>
                    </div>
                </div>
            </section>

            <!-- Appearance Section -->
            <section id="appearance" class="content-section">
                <div class="section-header">
                    <!-- <h1>Appearance</h1> -->
                    <!-- <p>Customize colors and themes for your profile.</p> -->
                </div>

                <div class="content-grid">
                    <!-- Theme Selection -->
                    <div class="card">
                        <h3>Preset Profile Color Changer</h3>
                        <p>These are the 14 highest converting color's worldwide.</p>
                        <div class="theme-grid">
                            
                            <div class="theme-option active" data-theme="default">
                                <div class="theme-preview gradient-default"></div>
                                <span>Default</span>
                            </div>

                            <div class="theme-option" data-theme="dark">
                                <div class="theme-preview gradient-dark"></div>
                                <span>Dark</span>
                            </div>

                            <div class="theme-option" data-theme="pink">
                                <div class="theme-preview gradient-pink"></div>
                                <span>Pink</span>
                            </div>

                            <div class="theme-option" data-theme="purple">
                                <div class="theme-preview gradient-purple"></div>
                                <span>Purple</span>
                            </div>

                            <div class="theme-option" data-theme="blue">
                                <div class="theme-preview gradient-blue"></div>
                                <span>Blue</span>
                            </div>

                            <div class="theme-option" data-theme="red">
                                <div class="theme-preview gradient-red"></div>
                                <span>Red</span>
                            </div>

                            <div class="theme-option" data-theme="green">
                                <div class="theme-preview gradient-green"></div>
                                <span>Green</span>
                            </div>

                            <div class="theme-option" data-theme="grey">
                                <div class="theme-preview gradient-grey"></div>
                                <span>Grey</span>
                            </div>

                            <div class="theme-option" data-theme="orange">
                                <div class="theme-preview gradient-orange"></div>
                                <span>Orange</span>
                            </div>

                            <div class="theme-option" data-theme="yellow">
                                <div class="theme-preview gradient-yellow"></div>
                                <span>Yellow</span>
                            </div>

                            <div class="theme-option" data-theme="teal">
                                <div class="theme-preview gradient-teal"></div>
                                <span>Teal</span>
                            </div>

                            <div class="theme-option" data-theme="brown">
                                <div class="theme-preview gradient-brown"></div>
                                <span>Brown</span>
                            </div>

                            <div class="theme-option" data-theme="gold">
                                <div class="theme-preview gradient-gold"></div>
                                <span>Gold</span>
                            </div>

                            <div class="theme-option" data-theme="silver">
                                <div class="theme-preview gradient-silver"></div>
                                <span>Silver</span>
                            </div>

                        </div>
                    </div>

                                <!-- Custom Colors -->
                                <div class="card">
                                    <h3>Custom Profile Color Changer</h3>
                                    <p>Be sure to choose a text color that works well and is easily readable with your chosen background color.</p>
                                    <div class="form-group">
                                        <label for="bg-color">Background Color</label>
                                        <div class="color-input">
                                            <input type="color" id="bg-color" value="#667eea">
                                            <input type="text" id="bg-color-text" value="#667eea">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="text-color">Text Color</label>
                                        <div class="color-input">
                                            <input type="color" id="text-color" value="#ffffff">
                                            <input type="text" id="text-color-text" value="#ffffff">
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="saveAppearance()">Save Colors</button>
                                </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="content-section">
                <div class="section-header">
                    <!-- <h1>Analytics</h1>
                    <p>This how your profile is performing.</p>
                -->

                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-views">0</div>
                        <div class="stat-label">Total Views</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-clicks">0</div>
                        <div class="stat-label">Total Link Clicks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="link-count">0</div>
                        <div class="stat-label">Number of Active Links</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="conversion-rate">0%</div>
                        <div class="stat-label">Click Rate</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Link Performance</h3>
                    <div id="link-stats" class="link-stats">
                        <div class="loading">Loading analytics...</div>
                    </div>
                </div>




 </section>

            



        </main>
    </div>

    <!-- Success/Error Messages -->
    <div id="message-container"></div>

    


<script>

        // API Configuration
        let API_BASE_URL = null; // Will be set after loading config

        let userToken = localStorage.getItem('userToken');
        let currentUser = null;
        let currentLinks = []; // Store current links data

       
       



        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            await loadConfig();
            if (checkAuthStatus()) {
                loadUserData();
            }
        });

        // Load configuration from server
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                API_BASE_URL = config.apiUrl;
                
            } catch (error) {
                console.error('Failed to load config:', error);
                // Fallback to hardcoded value
                API_BASE_URL = 'https://hotgirl-social-production.up.railway.app';
               
            }
        }




        // Authentication check
        function checkAuthStatus() {
            if (!userToken) {
              //window.location.href = '/login.html';
              window.location.href = '/';  
                return false;
            }
            return true;
        }

        // API Helper Function
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(userToken && { 'Authorization': `Bearer ${userToken}` })
                },
                ...options
            };

            try {
                const response = await fetch(url, config);
                
                if (!response.ok) {
                    if (response.status === 401) {
                        localStorage.removeItem('userToken');
                        window.location.href = '/login.html';
                        throw new Error('Authentication required');
                    }
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }









        // Load user profile data
        async function loadUserData() {
            try {
                const profile = await apiCall('/api/profile');
                currentUser = profile;
                
                // Update profile form
                document.getElementById('display-name').value = profile.display_name || '';
                document.getElementById('bio').value = profile.bio || '';


                // Apply theme to preview
                if (profile.theme) {
                    applyPreviewTheme(profile.theme);

                }
                
                // Update preview
                updatePreview();


                // Update profile image in preview
                const previewPhoto = document.getElementById('preview-photo');
                if (profile.profile_image_url) {
                    previewPhoto.innerHTML = `<img src="${profile.profile_image_url}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                } else {
                    previewPhoto.innerHTML = '<span>üë§</span>';
                }
                
                // Update account info
                document.getElementById('account-username').textContent = profile.username;
                document.getElementById('account-email').textContent = profile.email || 'N/A';
                document.getElementById('account-joined').textContent = new Date(profile.created_at).toLocaleDateString();
                
                // Set profile link
                document.getElementById('view-profile').href = `/${profile.username}`;
                // Set profile link for copy button feature
                document.getElementById('profile-url').value = `${API_BASE_URL}/${encodeURIComponent(profile.username)}`;

                // Initialize QR code now that we have the username
                const profileURL = `${API_BASE_URL}/${profile.username}`;
                document.getElementById('profileURL').textContent = profileURL;
                generateProfileQR();
               
                
                // Load links
                loadLinks();
                
                // Load analytics
                loadAnalytics();
                
            } catch (error) {
                showMessage('Failed to load profile data', 'error');
            }
        }

        // Update profile preview
        function updatePreview() {
            const displayName = document.getElementById('display-name').value || 'Your Display Name';
            const bio = document.getElementById('bio').value || 'Your bio will appear here...';
            
            document.getElementById('preview-name').textContent = displayName;
            document.getElementById('preview-bio').textContent = bio;
        }

        // Navigation
        function showSection(sectionId) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Update content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Profile form submission
        document.getElementById('profile-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const displayName = document.getElementById('display-name').value;
            const bio = document.getElementById('bio').value;
            
            try {
                await apiCall('/api/profile', {
                    method: 'PUT',
                    body: JSON.stringify({
                        display_name: displayName,
                        bio: bio,
                        theme: currentUser.theme,
                        custom_colors: currentUser.custom_colors
                    })
                });
                
                showMessage('Profile updated successfully!', 'success');
                updatePreview();
            } catch (error) {
                showMessage('Failed to update profile', 'error');
            }
        });

 
            document.getElementById('photo-input').addEventListener('change', async e => {
            const file = e.target.files[0];
            if (!file) return;

            // Size check
            if (file.size > 5 * 1024 * 1024) {
                showMessage('File too large (max 5MB)', 'error');
                return;
            }

            const preview = document.getElementById('photo-preview');
            const previewPhoto = document.getElementById('preview-photo');

            // Show instant preview + spinner
            const reader = new FileReader();
            reader.onload = ev => {
                preview.innerHTML = `
                <img src="${ev.target.result}" alt="Preview" style="width: 100%; height: 100%; border-radius: 25%;">
                <div class="spinner-overlay">‚è≥</div>
                `;
            };
            reader.readAsDataURL(file);

            // Prepare upload
            const formData = new FormData();
            formData.append('profileImage', file);

            try {
                const res = await fetch(`${API_BASE_URL}/api/profile/upload-image`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${userToken}` },
                body: formData
                });

                if (!res.ok) throw new Error('Upload failed');

                const data = await res.json();

                if (data.imageUrl) {
                // Update upload preview
                preview.innerHTML = `
                    <img src="${data.imageUrl}" alt="Profile Photo" style="max-width:100%;border-radius:50%;">
                `;
                
                // Update profile preview section
                previewPhoto.innerHTML = `<img src="${data.imageUrl}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                
                // Update profile in database
                const currentProfile = await apiCall('/api/profile');
                await apiCall('/api/profile', {
                    method: 'PUT',
                    body: JSON.stringify({
                    display_name: currentProfile.display_name,
                    bio: currentProfile.bio,
                    theme: currentProfile.theme,
                    profile_image_url: data.imageUrl
                    })
                });
                }

                showMessage('Photo uploaded successfully!', 'success');
            } catch (err) {
                showMessage('Failed to upload photo', 'error');
            }
            });




        // Load links
        async function loadLinks() {
            try {
                const profile = await apiCall('/api/profile');
                currentLinks = profile.links || []; // Store links data
                const linksList = document.getElementById('links-list');
                
                if (currentLinks.length > 0) {
                    linksList.innerHTML = currentLinks.map(link => `
                        <div class="link-item" data-id="${link.id}">
                            <div class="link-info">
                                <span class="link-icon">${link.icon || 'üîó'}</span>
                                <div class="link-details">
                                    <div class="link-title">${link.title}</div>
                                    <div class="link-url">${link.url}</div>
                                </div>
                                <div class="link-stats">
                                    <span class="click-count">${link.clicks || 0} clicks</span>
                                </div>
                            </div>
                            <div class="link-actions">
                                <button onclick="editLink(${link.id})" class="btn btn-small">Edit</button>
                                <button onclick="deleteLink(${link.id})" class="btn btn-small btn-danger">Delete</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    linksList.innerHTML = '<div class="empty-state">No links added yet. Add your first link above!</div>';
                }
                
                // Update preview
                updateLinksPreview(currentLinks);
            } catch (error) {
                document.getElementById('links-list').innerHTML = '<div class="error">Failed to load links</div>';
            }
        }

        // Modified form submission to handle both add and edit
        document.getElementById('add-link-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('link-title').value;
            const url = document.getElementById('link-url').value;
            const icon = document.getElementById('link-icon').value;
            const editingId = this.dataset.editingId;
            
            try {
                if (editingId) {
                    // Update existing link
                    await apiCall(`/api/links/${editingId}`, {
                        method: 'PUT',
                        body: JSON.stringify({ title, url, icon })
                    });
                    showMessage('Link updated successfully!', 'success');
                } else {
                    // Add new link
                    await apiCall('/api/links', {
                        method: 'POST',
                        body: JSON.stringify({ title, url, icon })
                    });
                    showMessage('Link added successfully!', 'success');
                }
                
                // Reset form
                this.reset();
                cancelEdit(); // Reset edit state
                loadLinks();
            } catch (error) {
                showMessage(editingId ? 'Failed to update link' : 'Failed to add link', 'error');
            }
        });

        // Improved edit link function
        function editLink(linkId) {
            // Find the link data from currentLinks array
            const linkData = currentLinks.find(link => link.id === linkId);
            if (!linkData) return;
            
            // Pre-fill the form with current values
            document.getElementById('link-title').value = linkData.title;
            document.getElementById('link-url').value = linkData.url;
            document.getElementById('link-icon').value = linkData.icon || 'üîó';
            
            // Change the form to edit mode
            const form = document.getElementById('add-link-form');
            const button = document.getElementById('link-submit-btn');
            const formTitle = document.getElementById('link-form-title');
            const cancelBtn = document.getElementById('cancel-edit-btn');
            
            button.textContent = 'Update Link';
            formTitle.textContent = 'Edit Link';
            form.dataset.editingId = linkId;
            cancelBtn.style.display = 'inline-block';
            
            // Scroll to form
            form.scrollIntoView({ behavior: 'smooth' });
        }

        // Cancel edit function
        function cancelEdit() {
            const form = document.getElementById('add-link-form');
            const button = document.getElementById('link-submit-btn');
            const formTitle = document.getElementById('link-form-title');
            const cancelBtn = document.getElementById('cancel-edit-btn');
            
            // Reset form
            form.reset();
            delete form.dataset.editingId;
            
            // Reset UI
            button.textContent = 'Add Link';
            formTitle.textContent = 'Add New Link';
            cancelBtn.style.display = 'none';
        }

        // Delete link
        async function deleteLink(linkId) {
            if (!confirm('Are you sure you want to delete this link?')) return;
            
            try {
                await apiCall(`/api/links/${linkId}`, { method: 'DELETE' });
                showMessage('Link deleted successfully!', 'success');
                loadLinks();
            } catch (error) {
                showMessage('Failed to delete link', 'error');
            }
        }

        // Load analytics
        async function loadAnalytics() {
        console.log('loadAnalytics() function called'); // Add this line
        try {
        console.log('Loading analytics from:', `${API_BASE_URL}/api/analytics`);
        const analytics = await apiCall('/api/analytics');
        console.log('Analytics response:', analytics);
        
        document.getElementById('total-views').textContent = analytics.total_views || 0;
        
        const totalClicks = analytics.link_stats?.reduce((sum, link) => sum + (link.clicks || 0), 0) || 0;
        document.getElementById('total-clicks').textContent = totalClicks;
        document.getElementById('link-count').textContent = analytics.link_stats?.length || 0;
        
        const clickRate = analytics.total_views > 0 ? ((totalClicks / analytics.total_views) * 100).toFixed(1) : 0;
        document.getElementById('conversion-rate').textContent = clickRate + '%';
        
        // Load link stats
        const linkStats = document.getElementById('link-stats');
        if (analytics.link_stats && analytics.link_stats.length > 0) {
            linkStats.innerHTML = analytics.link_stats.map(link => `
                <div class="link-stat-item">
                    <div class="link-stat-name">${link.title}</div>
                    <div class="link-stat-clicks">${link.clicks || 0} clicks</div>
                </div>
            `).join('');
        } else {
            linkStats.innerHTML = '<div class="empty-state">No link data available yet</div>';
        }
    } catch (error) {
        console.error('Analytics error details:', error);
        document.getElementById('link-stats').innerHTML = '<div class="error">Failed to load analytics</div>';
        showMessage('Failed to load analytics', 'error');
    }
}






        // Update links preview
        function updateLinksPreview(links) {
            const previewLinks = document.getElementById('preview-links');
            if (links && links.length > 0) {
                previewLinks.innerHTML = links.map(link => `
                    <div class="preview-link">
                        <span>${link.icon || 'üîó'}</span>
                        <span>${link.title}</span>
                    </div>
                `).join('');
            } else {
                previewLinks.innerHTML = '<div class="preview-link"><span>üîó</span><span>Your links will appear here</span></div>';
            }
        }

        // Show success/error messages
            function showMessage(message, type) {
            const container = document.getElementById('message-container');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = message;
            
            container.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 5000);
        }

        // Logout
        function logout() {
            localStorage.removeItem('userToken');
            window.location.href = '/';
        }

        // Real-time preview updates
        document.getElementById('display-name').addEventListener('input', updatePreview);
        document.getElementById('bio').addEventListener('input', updatePreview);

        // Theme selection
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove active class from all options
                document.querySelectorAll('.theme-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                
                // Add active class to clicked option
                this.classList.add('active');
                
                // Get the theme name
                const theme = this.dataset.theme;
                
                // Save theme
                saveTheme(theme);
            });
        });


        // Save theme function
        async function saveTheme(theme) {
        try {
        // Get current profile data first
        const currentProfile = await apiCall('/api/profile');
        
        // Send ALL profile data, just updating the theme
        await apiCall('/api/profile', {
            method: 'PUT',
            body: JSON.stringify({
                display_name: currentProfile.display_name,
                bio: currentProfile.bio,
                theme: theme
                // Include any other fields your profile has
            })
        });
        showMessage('Theme updated!', 'success');
        applyPreviewTheme(theme);
          } catch (error) {
        showMessage('Failed to update theme', 'error');
            }
        }
        

        // My Hotgirl Button Script
        async function copyProfileLink() {
        const urlInput = document.getElementById('profile-url');
        const successMsg = document.getElementById('copy-success');
        const button = document.getElementById('copy-link-btn');
        
        try {
            await navigator.clipboard.writeText(urlInput.value);
            successMsg.style.opacity = '1';
            button.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                successMsg.style.opacity = '0';
                button.style.transform = 'scale(1)';
            }, 2000);
            
        } catch (err) {
            urlInput.select();
            document.execCommand('copy');
            successMsg.style.opacity = '1';
            setTimeout(() => {
                successMsg.style.opacity = '0';
            }, 2000);
            }
        }



        // Apply theme to profile preview
        function applyPreviewTheme(themeName) {
        const themes = {
        default: { background: 'rgb(255 0 42 / 40%)' },
        dark: { background: 'linear-gradient(135deg, #1f2937 0%, #111827 100%)' },
        pink: { background: 'linear-gradient(135deg, #ec4899 0%, #be185d 100%)' },
        purple: { background: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)' },
        blue: { background: 'linear-gradient(170deg, rgb(0 106 255) 0%, rgb(2 32 96) 100%)' },
        red: { background: 'linear-gradient(170deg, rgb(255 0 0) 0%, rgb(96 2 2) 100%)' },
        green: { background: 'linear-gradient(170deg, rgb(0 200 83) 0%, rgb(0 77 36) 100%)' },
        grey: { background: 'linear-gradient(170deg, rgb(220 220 220) 0%, rgb(100 100 100) 100%)' },
        orange: { background: 'linear-gradient(170deg, rgb(255 165 0) 0%, rgb(153 76 0) 100%)' },
        yellow: { background: 'linear-gradient(170deg, rgb(255 235 59) 0%, rgb(204 153 0) 100%)' },
        teal: { background: 'linear-gradient(170deg, rgb(0 150 136) 0%, rgb(0 77 64) 100%)' },
        brown: { background: 'linear-gradient(170deg, rgb(139 69 19) 0%, rgb(70 35 10) 100%)' },
        gold: { background: 'linear-gradient(170deg, rgb(255 215 0) 0%, rgb(184 134 11) 100%)' },
        silver: { background: 'linear-gradient(170deg, rgb(224 224 224) 0%, rgb(136 136 136) 100%)' }
        };
    
        const theme = themes[themeName] || themes.default;
        const previewDiv = document.querySelector('.profile-preview');
        previewDiv.style.background = theme.background;
        }



       // Save custom appearance colors
       async function saveAppearance() {
       try {
        const bgColor = document.getElementById('bg-color').value;
        const textColor = document.getElementById('text-color').value;
        
        // Get current profile data
        const currentProfile = await apiCall('/api/profile');
        
        
        await apiCall('/api/profile', {
            method: 'PUT',
            body: JSON.stringify({
                display_name: currentProfile.display_name,
                bio: currentProfile.bio,
                theme: 'custom', // Set theme to custom
                custom_colors: {
                    background: bgColor,
                    textColor: textColor
                }
            })
        });
        
        // Apply to preview immediately
        const previewDiv = document.querySelector('.profile-preview');
        previewDiv.style.background = bgColor;
        previewDiv.style.color = textColor;
        
        showMessage('Custom colors saved!', 'success');
       } catch (error) {
        showMessage('Failed to save colors', 'error');
    }
}





// Password change form handler
    document.getElementById('password-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const currentPassword = document.getElementById('current-password').value;
    const newPassword = document.getElementById('new-password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
    
    // Check if new passwords match
    if (newPassword !== confirmPassword) {
        showMessage('New passwords do not match', 'error');
        return;
    }
    
    try {
        await apiCall('/api/auth/change-password', {
            method: 'POST',
            body: JSON.stringify({
                currentPassword: currentPassword,
                newPassword: newPassword
            })
        });
        
        showMessage('Password updated successfully!', 'success');
        
        // Clear the form
        this.reset();
    } catch (error) {
        showMessage('Failed to change password', 'error');
    }
});





// ============================= QR Code functionality for dashboard ================================
// QR Code functionality for dashboard
let currentQRCanvas = null;

function generateProfileQR() {
    //const profileURL = `https://hotgirl-social-production.up.railway.app/${username}`;
    const username = document.getElementById('account-username').textContent;
    const profileURL = `${API_BASE_URL}/${username}`;
    const foregroundColor = document.getElementById('qrForeground').value;
    const backgroundColor = document.getElementById('qrBackground').value;
    const qrDisplay = document.getElementById('qrDisplay');
    const downloadBtn = document.getElementById('downloadQRBtn');
    
    // Clear previous QR code
    qrDisplay.innerHTML = '';
    
    try {
        // Create canvas element
        const canvas = document.createElement('canvas');
        
        // Generate QR code
        const qr = new QRious({
            element: canvas,
            value: profileURL,
            size: 256,
            background: backgroundColor,
            foreground: foregroundColor
        });
        
        // Display the QR code
        qrDisplay.appendChild(canvas);
        
        // Store canvas for download
        currentQRCanvas = canvas;
        
        // Show download button
        downloadBtn.style.display = 'inline-block';
        
        // Show success message
        showStatus('success', 'QR code generated successfully!');
        
    } catch (error) {
        showStatus('error', 'Error generating QR code: ' + error.message);
        downloadBtn.style.display = 'none';
    }
}

function downloadQR() {
    if (currentQRCanvas) {
        const username = document.getElementById('account-username').textContent;
        const link = document.createElement('a');
        link.download = `${username}-profile-qr.png`;
        link.href = currentQRCanvas.toDataURL();
        link.click();
        
        showStatus('success', 'QR code downloaded!');
    }
}

function showStatus(type, message) {
    const statusDiv = document.getElementById('qrStatus');
    statusDiv.className = `status-message status-${type}`;
    statusDiv.textContent = message;
    
    // Clear status after 3 seconds
    setTimeout(() => {
        statusDiv.textContent = '';
        statusDiv.className = 'status-message';
    }, 3000);
}

// Update QR code when colors change
document.getElementById('qrForeground').addEventListener('change', generateProfileQR);
document.getElementById('qrBackground').addEventListener('change', generateProfileQR);


// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ QR Code functionality for dashboard ^^^^^^^^^^^^^^^^^^^^^^^^^^^^





</script>
</body>
</html>