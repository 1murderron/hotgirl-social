<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Profile - HotGirl.social</title>
    
    <link rel="stylesheet" href="assets/profile.css">


</head>
<body class="profile">
    <!-- Loading State -->
    <div id="loading-screen" class="loading-screen">
        <div class="spinner"></div>
        <p>Loading profile...</p>
    </div>

    <!-- Error State -->
    <div id="error-screen" class="error-screen" style="display: none;">
        <div class="error-content">
            <h1>Profile Not Found</h1>
            <p>This profile can't be found or has been deactivated.</p>
            <a href="/" class="btn btn-primary">Go to hotgirl.social</a>
        </div>
    </div>

    <!-- Profile Content -->
<div id="profile-content" class="profile-container" style="display: none;">
    <div class="profile-tile">
        <!-- Header -->
        <header class="profile-header">
            <div class="profile-photo" id="profile-photo">
                <span class="photo-placeholder">ðŸ‘¤</span>
            </div>
            <h1 class="profile-name" id="profile-name">Loading...</h1>
            <p class="profile-bio" id="profile-bio"></p>
        </header>

        <!-- Links Section -->
        <main class="profile-links" id="profile-links">
            <!-- Links will be inserted here -->
        </main>
    </div>


    <!-- ================== TIP JAR ====================================================-->
    <div class="profile-tile">
       <!-- <h1 class="tip-jar" id="tip-jar">Tip Jar</h1> -->
        <!-- <p class="tip-jar-text" id="tip-jar-text">Please leave a tip.</p> -->

            <div id="tip-jar-section" class="tip-jar-container" style="display: none;">
            <div class="tip-jar-card">
                <h3 class="tip-jar-title">Tip Jar</h3>
                <p id="tip-jar-message" class="tip-jar-message">Please leave a tip.</p>
                
                <!-- Quick amount buttons -->
                <div class="tip-amounts">
                <button class="tip-btn" data-amount="5">$5</button>
                <button class="tip-btn" data-amount="10">$10</button>
                <button class="tip-btn" data-amount="25">$25</button>
                <button class="tip-btn" data-amount="50">$50</button>
                </div>
                
                <!-- Custom amount -->
                <div class="custom-amount">
                <input type="number" id="custom-amount" placeholder="Custom amount" min="1" max="500">
                <button id="tip-custom-btn" class="tip-btn tip-btn-custom">Tip Custom Amount</button>
                </div>
                
                <!-- Recent tips display (for monthly contest) -->
                <div id="recent-tips" class="recent-tips" style="display: none;">
                <p class="recent-tips-text">This month: <span id="monthly-total">$0</span> from <span id="tip-count">0</span> supporters</p>
                </div>
            </div>
            </div>

    </div>
    <!-- ================== END TIP JAR ================================================-->



    <!-- Footer -->
    <footer class="profile-footer">
        <div class="powered-by">
            <span>Powered by</span>
            <a href="/" class="brand-link">hotgirl.social</a>
        </div>
    </footer>
</div>

    <script>
        // API Configuration
        //const API_BASE_URL = 'https://hotgirl-social-production.up.railway.app'; 
        //const API_BASE_URL = window.location.origin;
          const API_BASE_URL = ''; // same origin


        
        // Get username from URL path
        const pathParts = window.location.pathname.split('/');
        const username = pathParts[pathParts.length - 1];

        // Theme configurations
        const themes = {
            default: {
                background: 'rgb(255 0 42 / 40%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },
            dark: {
                background: 'linear-gradient(135deg, #1f2937 0%, #111827 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.1)',
                linkHover: 'rgba(255, 255, 255, 0.2)'
            },
            pink: {
                background: 'linear-gradient(135deg, #ec4899 0%, #be185d 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },
            purple: {
                background: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            blue: {
                background: 'linear-gradient(170deg, rgb(0 106 255) 0%, rgb(2 32 96) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            red: {
                background: 'linear-gradient(170deg, rgb(255 0 0) 0%, rgb(96 2 2) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            green: {
                background: 'linear-gradient(170deg, rgb(0 200 83) 0%, rgb(0 77 36) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            grey: {
                background: 'linear-gradient(170deg, rgb(220 220 220) 0%, rgb(100 100 100) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            orange: {
                background: 'linear-gradient(170deg, rgb(255 165 0) 0%, rgb(153 76 0) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            yellow: {
                background: 'linear-gradient(170deg, rgb(255 235 59) 0%, rgb(204 153 0) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            teal: {
                background: 'linear-gradient(170deg, rgb(0 150 136) 0%, rgb(0 77 64) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            brown: {
                background: 'linear-gradient(170deg, rgb(139 69 19) 0%, rgb(70 35 10) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            gold: {
                background: 'linear-gradient(170deg, rgb(255 215 0) 0%, rgb(184 134 11) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            },

            silver: {
                background: 'linear-gradient(170deg, rgb(224 224 224) 0%, rgb(136 136 136) 100%)',
                textColor: '#ffffff',
                linkBackground: 'rgba(255, 255, 255, 0.2)',
                linkHover: 'rgba(255, 255, 255, 0.3)'
            }


        };


            // Load profile data WORKING !!!!! 
            /*
                            sync function loadProfile() {
                                try {
                                    const res = await fetch(`${API_BASE_URL}/api/profile-data/${encodeURIComponent(username)}`);
                                    if (!res.ok) throw new Error('Profile not found');

                                    const profile = await res.json();
                                    displayProfile(profile);
                                    // trackPageView(profile.id); // optional
                                } catch (err) {
                                    console.error('Error loading profile:', err);
                                    shaowError();
                                }
                                }
            */


                            // Load profile data
                                async function loadProfile() {
                                try {
                                    const response = await fetch(`${API_BASE_URL}/api/profile-data/${encodeURIComponent(username)}`);
                                    if (!response.ok) throw new Error('Profile not found');

                                    const profile = await response.json();
                                    displayProfile(profile);
                                    initializeTipJar(profile);
                                    // trackPageView(profile.id); // leave commented (no server route)
                                } catch (err) {
                                    console.error('Error loading profile:', err);
                                    showError();
                                }
                                }
                               










        // Display profile data
        function displayProfile(profile) {
            // Hide loading screen
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('profile-content').style.display = 'block';

            // Set page title
            document.getElementById('page-title').textContent = `${profile.display_name || profile.username} - hotgirl.social`;

            // Apply theme
            //applyTheme(profile.theme || 'default');
            applyTheme(profile.theme || 'default', profile.custom_colors);


            // Set profile photo
            const photoElement = document.getElementById('profile-photo');
            if (profile.profile_image_url && !profile.profile_image_url.includes('/uploads/')) {
                photoElement.innerHTML = `<img src="${profile.profile_image_url}" alt="Profile photo" class="profile-img">`;
            } else {
                photoElement.innerHTML = '<span class="photo-placeholder">ðŸ‘¤</span>';
            }

            // Set profile name and bio
            document.getElementById('profile-name').textContent = profile.display_name || profile.username;
            
            const bioElement = document.getElementById('profile-bio');
            if (profile.bio) {
                // This preserves line breaks from the textarea
                bioElement.innerHTML = profile.bio.replace(/\n/g, '<br>');
                //bioElement.textContent = profile.bio;
                bioElement.style.display = 'block';
            } else {
                bioElement.style.display = 'none';
            }

            // Display links
            displayLinks(profile.links);
        }

        // Display links
        function displayLinks(links) {
            const linksContainer = document.getElementById('profile-links');
            
            if (!links || links.length === 0) {
                linksContainer.innerHTML = '<div class="no-links">No links added yet</div>';
                return;
            }

            linksContainer.innerHTML = links.map(link => `
                <a href="#" class="profile-link" data-url="${link.url}" data-id="${link.id}" onclick="handleLinkClick(event, '${link.url}', ${link.id})">
                    <span class="link-icon">${link.icon || 'ðŸ”—'}</span>
                    <span class="link-title">${link.title}</span>
                    <span class="link-arrow">â†’</span>
                </a>
            `).join('');
        }

        

            // Apply theme styling
function applyTheme(themeName, customColors = null) {
    let theme;
    
    if (themeName === 'custom' && customColors) {
        // Use custom colors
        theme = {
            background: customColors.background,
            textColor: customColors.textColor,
            linkBackground: 'rgba(255, 255, 255, 0.2)',
            linkHover: 'rgba(255, 255, 255, 0.3)'
        };
    } else {
        // Use predefined theme
        theme = themes[themeName] || themes.default;
    }
    
    document.body.style.background = theme.background;
    document.body.style.color = theme.textColor;
    
    // Update CSS custom properties for dynamic styling
    document.documentElement.style.setProperty('--link-bg', theme.linkBackground);
    document.documentElement.style.setProperty('--link-hover', theme.linkHover);
    document.documentElement.style.setProperty('--text-color', theme.textColor);
}





        // Handle link clicks
        async function handleLinkClick(event, url, linkId) {
            event.preventDefault();
            
            // Track the click
            try {
                await fetch(`${API_BASE_URL}/api/links/${linkId}/click`, {
                    method: 'POST'
                });
            } catch (error) {
                console.error('Error tracking click:', error);
            }
            
            // Open link
            window.open(url, '_blank');
        }

        // Track page view
        async function trackPageView(profileId) {
            try {
                // This endpoint might not exist yet, but we'll add it later
                await fetch(`${API_BASE_URL}/api/analytics/page-view`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ profileId })
                });
            } catch (error) {
                // Silently fail - analytics not critical
            }
        }

        // Show error state
        function showError() {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('error-screen').style.display = 'flex';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (!username) {
                showError();
                return;
            }
            
            loadProfile();
        });

        // Add some visual feedback for link interactions
        document.addEventListener('mousedown', function(e) {
            if (e.target.closest('.profile-link')) {
                e.target.closest('.profile-link').style.transform = 'scale(0.98)';
            }
        });

        document.addEventListener('mouseup', function(e) {
            if (e.target.closest('.profile-link')) {
                e.target.closest('.profile-link').style.transform = 'scale(1)';
            }
        });
    </script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="tipjar.js"></script>
</body>
</html>